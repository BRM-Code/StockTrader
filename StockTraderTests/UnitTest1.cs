using Microsoft.VisualStudio.TestTools.UnitTesting;
using Newtonsoft.Json.Linq;
using StockTrader_.NET_Framework_;

namespace StockTraderTests
{
    [TestClass]
    public class UnitTests
    {

        [TestMethod]
        public async void SmaTest()
        {
            var input = _testJToken;
            var expected = new[] {46.907, 20.079, 20.322, 16.204, 23.607, 48.591,
                53.0212, 70.451, 112.064, 166.421, 111.22, 190.313,
                285.392, 368.506, 570.9764, 483.8332, 539.9, 110.261,
                116.265, 104.199, 143.574, 176.0916, 193.312, 249.47};
            var actual = await Predictor.Sma(input, 240);
            Assert.AreEqual(expected.Length, actual.Length);
            for (var i = 0; i < actual.Length;)
            {
                Assert.AreEqual(expected[i].ToString(), actual[i].ToString());
                i++;
            }
        }

        [TestMethod]
        public async void EmaTest()
        {
            var input = _testJToken;
            var expected = new[]
            {
                47.554, 47.83896, 47.87487, 47.89533, 48.00854,
                47.82787, 47.58627, 47.32485, 47.04636, 46.81915,
                46.56799, 46.35513, 46.17221, 45.94377, 45.74726,
                45.51064, 45.27055, 45.00465, 44.75932, 44.54581,
                44.34222, 44.16602, 43.96296, 43.78623, 43.60654,
                43.41935, 43.18019, 42.91786, 42.65093, 42.3862,
                42.13553, 41.88567, 41.62226, 41.3606, 41.10601,
                40.84478, 40.58532, 40.36488, 40.15311, 39.96347,
                39.7913, 39.60088, 39.43233, 39.24655, 39.06689,
                38.89743, 38.74556, 38.62344, 38.49263, 38.38115,
                38.31517, 38.24006, 38.19836, 38.20849, 38.36134,
                38.67778, 38.95996, 39.37398, 39.43536, 39.46453,
                39.42857, 39.4337, 39.40461, 39.44051, 39.52593,
                39.69223, 39.89277, 40.22676, 40.59792, 40.99795,
                41.32546, 41.58822, 41.93369, 42.14698, 42.33109,
                42.63095, 42.94427, 43.33641, 43.79977, 44.39236,
                44.91283, 45.42929, 45.91484, 46.52528, 47.20127,
                48.14869, 49.08935, 50.18741, 51.36065, 52.71945,
                54.5192, 56.21707, 58.13725, 59.19269, 60.08041,
                61.2615, 62.83044, 64.57585, 65.9671, 67.29066,
                68.78158, 69.39784, 69.92348, 70.23329, 70.46171,
                70.7358, 71.01098, 71.50469, 72.32116, 73.29311,
                74.36497, 75.76259, 77.19247, 78.88244, 80.62917,
                82.5595, 84.65343, 86.39079, 88.3316, 90.77682,
                93.63737, 96.40491, 99.05862, 101.7939, 104.2841,
                107.3783, 110.7669, 114.3546, 118.0942, 122.08,
                126.2852, 130.373, 134.3981, 138.3698, 142.0629,
                146.8877, 151.4388, 155.8413, 160.532, 164.8851,
                169.7269, 175.5006, 183.0293, 191.5762, 199.686,
                207.3834, 215.3275, 223.8504, 233.3539, 242.8788,
                250.6885, 258.3098, 264.9505, 269.3633, 273.24,
                277.1623, 281.0987, 285.1375, 287.9701, 292.0624,
                297.0263, 301.5619, 307.1937, 313.6247, 319.9118,
                324.7197, 330.0183, 335.633, 342.6567, 350.7485,
                343.5026, 336.3997, 329.6362, 322.8996, 316.4912,
                310.5009, 304.3744, 298.5518, 293.1771, 287.7462,
                282.4464, 277.4048, 272.3029, 267.1028, 261.5968,
                256.1494, 251.1938, 246.2885, 240.8666, 235.3129,
                229.9144, 225.069, 219.7178, 214.6887, 209.6165,
                205.0423, 200.6466, 196.6495, 192.7802, 188.8557,
                185.292, 182.3789, 180.0974, 178.1823, 176.394,
                175.1038, 173.3767, 171.9487, 171.5154, 170.437,
                170.4004, 170.3704, 170.3559, 170.1279, 170.7511,
                170.5302, 170.2006, 171.6831, 172.7385, 175.1377,
                180.2113, 184.9852, 188.5709, 188.1142, 184.2054,
                182.0497, 181.0138, 182.5318, 186.7392, 184.8827,
                188.2077, 193.3461, 196.2537, 203.4577, 216.6241,
                233.5061, 258.5996, 281.4498, 282.0033, 246.5,};
            var actual = await Predictor.Ema(input, 240);
            Assert.AreEqual(expected.Length, actual.Length);
            for (var i = 0; i < actual.Length;)
            {
                Assert.AreEqual(expected[i].ToString(), actual[i].ToString());
                i++;
            }
        }

        private readonly JToken _testJToken = JToken.Parse(@"{
          ""2020-04-08"": {""1. open"": ""246.5000""},""2020-03-31"": {""1. open"": ""282.2800""},
          ""2020-02-28"": {""1. open"": ""304.3000""},""2020-01-31"": {""1. open"": ""296.2400""},
          ""2019-12-31"": {""1. open"": ""267.2700""},""2019-11-29"": {""1. open"": ""249.5400""},
          ""2019-10-31"": {""1. open"": ""225.0700""},""2019-09-30"": {""1. open"": ""206.4300""},
          ""2019-08-30"": {""1. open"": ""213.9000""},""2019-07-31"": {""1. open"": ""203.1700""},
          ""2019-06-28"": {""1. open"": ""175.6000""},""2019-05-31"": {""1. open"": ""209.8800""},
          ""2019-04-30"": {""1. open"": ""191.6400""},""2019-03-29"": {""1. open"": ""174.2800""},
          ""2019-02-28"": {""1. open"": ""166.9600""},""2019-01-31"": {""1. open"": ""154.8900""},
          ""2018-12-31"": {""1. open"": ""184.4600""},""2018-11-30"": {""1. open"": ""219.0500""},
          ""2018-10-31"": {""1. open"": ""227.9500""},""2018-09-28"": {""1. open"": ""228.4100""},
          ""2018-08-31"": {""1. open"": ""199.1300""},""2018-07-31"": {""1. open"": ""183.8200""},
          ""2018-06-29"": {""1. open"": ""187.9912""},""2018-05-31"": {""1. open"": ""166.4102""},
          ""2018-04-30"": {""1. open"": ""167.8800""},""2018-03-29"": {""1. open"": ""178.5400""},
          ""2018-02-28"": {""1. open"": ""167.1650""},""2018-01-31"": {""1. open"": ""170.1600""},
          ""2017-12-29"": {""1. open"": ""169.9500""},""2017-11-30"": {""1. open"": ""169.8700""},
          ""2017-10-31"": {""1. open"": ""154.2600""},""2017-09-29"": {""1. open"": ""164.8000""},
          ""2017-08-31"": {""1. open"": ""149.1000""},""2017-07-31"": {""1. open"": ""144.8800""},
          ""2017-06-30"": {""1. open"": ""153.1700""},""2017-05-31"": {""1. open"": ""145.1000""},
          ""2017-04-28"": {""1. open"": ""143.7100""},""2017-03-31"": {""1. open"": ""137.8900""},
          ""2017-02-28"": {""1. open"": ""127.0300""},""2017-01-31"": {""1. open"": ""115.8000""},
          ""2016-12-30"": {""1. open"": ""110.3650""},""2016-11-30"": {""1. open"": ""113.4600""},
          ""2016-10-31"": {""1. open"": ""112.7100""},""2016-09-30"": {""1. open"": ""106.1400""},
          ""2016-08-31"": {""1. open"": ""104.4100""},""2016-07-29"": {""1. open"": ""95.4900""},
          ""2016-06-30"": {""1. open"": ""99.0200""},""2016-05-31"": {""1. open"": ""93.9650""},
          ""2016-04-29"": {""1. open"": ""108.7800""},""2016-03-31"": {""1. open"": ""97.6500""},
          ""2016-02-29"": {""1. open"": ""96.4700""},""2016-01-29"": {""1. open"": ""102.6100""},
          ""2015-12-31"": {""1. open"": ""118.7500""},""2015-11-30"": {""1. open"": ""119.8700""},
          ""2015-10-30"": {""1. open"": ""109.0700""},""2015-09-30"": {""1. open"": ""110.1800""},
          ""2015-08-31"": {""1. open"": ""121.5000""},""2015-07-31"": {""1. open"": ""126.9000""},
          ""2015-06-30"": {""1. open"": ""131.2000""},""2015-05-29"": {""1. open"": ""126.1000""},
          ""2015-04-30"": {""1. open"": ""124.8200""},""2015-03-31"": {""1. open"": ""129.2500""},
          ""2015-02-27"": {""1. open"": ""118.0500""},""2015-01-30"": {""1. open"": ""111.3900""},
          ""2014-12-31"": {""1. open"": ""118.8100""},""2014-11-28"": {""1. open"": ""108.2200""},
          ""2014-10-31"": {""1. open"": ""100.5900""},""2014-09-30"": {""1. open"": ""103.0600""},
          ""2014-08-29"": {""1. open"": ""94.9000""},""2014-07-31"": {""1. open"": ""93.5200""},
          ""2014-06-30"": {""1. open"": ""633.9600""},""2014-05-30"": {""1. open"": ""592.0000""},
          ""2014-04-30"": {""1. open"": ""537.7600""},""2014-03-31"": {""1. open"": ""523.4200""},
          ""2014-02-28"": {""1. open"": ""502.6100""},""2014-01-31"": {""1. open"": ""555.6800""},
          ""2013-12-31"": {""1. open"": ""558.0000""},""2013-11-29"": {""1. open"": ""524.0200""},
          ""2013-10-31"": {""1. open"": ""478.4500""},""2013-09-30"": {""1. open"": ""493.1000""},
          ""2013-08-30"": {""1. open"": ""455.7527""},""2013-07-31"": {""1. open"": ""402.6900""},
          ""2013-06-28"": {""1. open"": ""450.7300""},""2013-05-31"": {""1. open"": ""444.4600""},
          ""2013-04-30"": {""1. open"": ""441.9000""},""2013-03-28"": {""1. open"": ""438.0000""},
          ""2013-02-28"": {""1. open"": ""459.1100""},""2013-01-31"": {""1. open"": ""553.8200""},
          ""2012-12-31"": {""1. open"": ""593.6500""},""2012-11-30"": {""1. open"": ""598.2200""},
          ""2012-10-31"": {""1. open"": ""671.5000""},""2012-09-28"": {""1. open"": ""665.7600""},
          ""2012-08-31"": {""1. open"": ""615.9050""},""2012-07-31"": {""1. open"": ""584.7300""},
          ""2012-06-29"": {""1. open"": ""569.1600""},""2012-05-31"": {""1. open"": ""584.9000""},
          ""2012-04-30"": {""1. open"": ""601.8300""},""2012-03-30"": {""1. open"": ""548.1700""},
          ""2012-02-29"": {""1. open"": ""458.4100""},""2012-01-31"": {""1. open"": ""409.4000""},
          ""2011-12-30"": {""1. open"": ""382.5400""},""2011-11-30"": {""1. open"": ""397.4100""},
          ""2011-10-31"": {""1. open"": ""380.3700""},""2011-09-30"": {""1. open"": ""385.8200""},
          ""2011-08-31"": {""1. open"": ""397.7800""},""2011-07-29"": {""1. open"": ""335.9500""},
          ""2011-06-30"": {""1. open"": ""348.8700""},""2011-05-31"": {""1. open"": ""349.7400""},
          ""2011-04-29"": {""1. open"": ""351.1100""},""2011-03-31"": {""1. open"": ""355.4700""},
          ""2011-02-28"": {""1. open"": ""341.3000""},""2011-01-31"": {""1. open"": ""325.6400""},
          ""2010-12-31"": {""1. open"": ""315.2700""},""2010-11-30"": {""1. open"": ""302.2200""},
          ""2010-10-29"": {""1. open"": ""283.7500""},""2010-09-30"": {""1. open"": ""247.4700""},
          ""2010-08-31"": {""1. open"": ""260.4400""},""2010-07-30"": {""1. open"": ""254.3000""},
          ""2010-06-30"": {""1. open"": ""259.6900""},""2010-05-28"": {""1. open"": ""263.8400""},
          ""2010-04-30"": {""1. open"": ""237.4900""},""2010-03-31"": {""1. open"": ""205.7500""},
          ""2010-02-26"": {""1. open"": ""192.3700""},""2010-01-29"": {""1. open"": ""213.4300""},
          ""2009-12-31"": {""1. open"": ""202.2400""},""2009-11-30"": {""1. open"": ""189.8000""},
          ""2009-10-30"": {""1. open"": ""185.3500""},""2009-09-30"": {""1. open"": ""167.9900""},
          ""2009-08-31"": {""1. open"": ""165.2100""},""2009-07-31"": {""1. open"": ""143.5000""},
          ""2009-06-30"": {""1. open"": ""136.4700""},""2009-05-29"": {""1. open"": ""125.8000""},
          ""2009-04-30"": {""1. open"": ""104.0900""},""2009-03-31"": {""1. open"": ""89.3100""},
          ""2009-02-27"": {""1. open"": ""89.1000""},""2009-01-30"": {""1. open"": ""85.8800""},
          ""2008-12-31"": {""1. open"": ""91.3000""},""2008-11-28"": {""1. open"": ""105.9300""},
          ""2008-10-31"": {""1. open"": ""111.9200""},""2008-09-30"": {""1. open"": ""172.4000""},
          ""2008-08-29"": {""1. open"": ""159.9400""},""2008-07-31"": {""1. open"": ""164.0500""},
          ""2008-06-30"": {""1. open"": ""188.5000""},""2008-05-30"": {""1. open"": ""175.0100""},
          ""2008-04-30"": {""1. open"": ""146.3000""},""2008-03-31"": {""1. open"": ""124.4400""},
          ""2008-02-29"": {""1. open"": ""136.2400""},""2008-01-31"": {""1. open"": ""199.2700""},
          ""2007-12-31"": {""1. open"": ""181.8600""},""2007-11-30"": {""1. open"": ""188.6000""},
          ""2007-10-31"": {""1. open"": ""154.6300""},""2007-09-28"": {""1. open"": ""139.9400""},
          ""2007-08-31"": {""1. open"": ""133.6400""},""2007-07-31"": {""1. open"": ""121.0500""},
          ""2007-06-29"": {""1. open"": ""121.1000""},""2007-05-31"": {""1. open"": ""99.5900""},
          ""2007-04-30"": {""1. open"": ""94.1400""},""2007-03-30"": {""1. open"": ""84.0300""},
          ""2007-02-28"": {""1. open"": ""86.2300""},""2007-01-31"": {""1. open"": ""86.2900""},
          ""2006-12-29"": {""1. open"": ""91.8000""},""2006-11-30"": {""1. open"": ""81.1000""},
          ""2006-10-31"": {""1. open"": ""75.1000""},""2006-09-29"": {""1. open"": ""68.4800""},
          ""2006-08-31"": {""1. open"": ""67.2200""},""2006-07-31"": {""1. open"": ""57.5200""},
          ""2006-06-30"": {""1. open"": ""59.8500""},""2006-05-31"": {""1. open"": ""70.7800""},
          ""2006-04-28"": {""1. open"": ""63.6600""},""2006-03-31"": {""1. open"": ""69.0000""},
          ""2006-02-28"": {""1. open"": ""75.0000""},""2006-01-31"": {""1. open"": ""72.3320""},
          ""2005-12-30"": {""1. open"": ""68.9500""},""2005-11-30"": {""1. open"": ""57.2400""},
          ""2005-10-31"": {""1. open"": ""54.1600""},""2005-09-30"": {""1. open"": ""47.0000""},
          ""2005-08-31"": {""1. open"": ""42.6000""},""2005-07-29"": {""1. open"": ""36.8300""},
          ""2005-06-30"": {""1. open"": ""39.8900""},""2005-05-31"": {""1. open"": ""36.2100""},
          ""2005-04-29"": {""1. open"": ""42.0900""},""2005-03-31"": {""1. open"": ""44.9900""},
          ""2005-02-28"": {""1. open"": ""77.0500""},""2005-01-31"": {""1. open"": ""64.7800""},
          ""2004-12-31"": {""1. open"": ""67.7900""},""2004-11-30"": {""1. open"": ""52.5000""},
          ""2004-10-29"": {""1. open"": ""39.1500""},""2004-09-30"": {""1. open"": ""34.3000""},
          ""2004-08-31"": {""1. open"": ""31.1800""},""2004-07-30"": {""1. open"": ""32.0800""},
          ""2004-06-30"": {""1. open"": ""27.7900""},""2004-05-28"": {""1. open"": ""26.0000""},
          ""2004-04-30"": {""1. open"": ""26.9000""},""2004-03-31"": {""1. open"": ""24.0900""},
          ""2004-02-27"": {""1. open"": ""22.4600""},""2004-01-30"": {""1. open"": ""21.5500""},
          ""2003-12-31"": {""1. open"": ""21.0400""},""2003-11-28"": {""1. open"": ""22.8300""},
          ""2003-10-31"": {""1. open"": ""20.7500""},""2003-09-30"": {""1. open"": ""22.6600""},
          ""2003-08-29"": {""1. open"": ""21.0000""},""2003-07-31"": {""1. open"": ""18.8700""},
          ""2003-06-30"": {""1. open"": ""18.1000""},""2003-05-30"": {""1. open"": ""14.2500""},
          ""2003-04-30"": {""1. open"": ""14.2000""},""2003-03-31"": {""1. open"": ""15.0100""},
          ""2003-02-28"": {""1. open"": ""14.4100""},""2003-01-31"": {""1. open"": ""14.3600""},
          ""2002-12-31"": {""1. open"": ""15.9000""},""2002-11-29"": {""1. open"": ""15.9400""},
          ""2002-10-31"": {""1. open"": ""14.5900""},""2002-09-30"": {""1. open"": ""14.4900""},
          ""2002-08-30"": {""1. open"": ""15.1100""},""2002-07-31"": {""1. open"": ""17.7100""},
          ""2002-06-28"": {""1. open"": ""23.3900""},""2002-05-31"": {""1. open"": ""24.2900""},
          ""2002-04-30"": {""1. open"": ""24.7000""},""2002-03-28"": {""1. open"": ""21.9300""},
          ""2002-02-28"": {""1. open"": ""24.9600""},""2002-01-31"": {""1. open"": ""22.0500""},
          ""2001-12-31"": {""1. open"": ""21.0600""},""2001-11-30"": {""1. open"": ""17.6500""},
          ""2001-10-31"": {""1. open"": ""15.4900""},""2001-09-28"": {""1. open"": ""18.5000""},
          ""2001-08-31"": {""1. open"": ""19.0100""},""2001-07-31"": {""1. open"": ""23.6400""},
          ""2001-06-29"": {""1. open"": ""20.1300""},""2001-05-31"": {""1. open"": ""25.4100""},
          ""2001-04-30"": {""1. open"": ""22.0900""},""2001-03-30"": {""1. open"": ""17.8100""},
          ""2001-02-28"": {""1. open"": ""20.6900""},""2001-01-31"": {""1. open"": ""14.8800""},
          ""2000-12-29"": {""1. open"": ""17.0000""},""2000-11-30"": {""1. open"": ""19.4400""},
          ""2000-10-31"": {""1. open"": ""26.6900""},""2000-09-29"": {""1. open"": ""61.3100""},
          ""2000-08-31"": {""1. open"": ""50.3100""},""2000-07-31"": {""1. open"": ""52.1300""},
          ""2000-06-30"": {""1. open"": ""81.7500""},""2000-05-31"": {""1. open"": ""124.8700""}
        }");
    }
}
